#!/usr/bin/with-contenv bash
umask 002

echo "Starting rTorrent"

exec \
	screen -D -m -S \
	rtorrent s6-setuidgid bytesized /usr/bin/rtorrent \
	-n -o import=/config/rtorrent/rtorrent.rc
until [ -e "/config/rtorrent/rtorrent_sess/rtorrent.lock" ];
do
sleep 1s
done

rtorrent_pid=$(cat /config/rtorrent/rtorrent_sess/rtorrent.lock | cut -d '+' -f 2)
tail -n 1 -f /config/log/rtorrent/rtorrent.log "$rtorrent_pid"
